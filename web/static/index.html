<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sniffox</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
    <div id="app">
        <nav id="navbar">
            <div class="nav-brand"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" fill="none" class="nav-logo"><polygon points="8,8 4,36 22,28" fill="currentColor"/><polygon points="56,8 60,36 42,28" fill="currentColor"/><ellipse cx="32" cy="38" rx="22" ry="20" fill="currentColor"/><polygon points="12,16 10,30 20,26" fill="var(--accent-dim)"/><polygon points="52,16 54,30 44,26" fill="var(--accent-dim)"/><ellipse cx="23" cy="34" rx="3.5" ry="4" fill="var(--bg-base)"/><ellipse cx="41" cy="34" rx="3.5" ry="4" fill="var(--bg-base)"/><circle cx="24.5" cy="32.5" r="1.2" fill="#fff"/><circle cx="42.5" cy="32.5" r="1.2" fill="#fff"/><ellipse cx="32" cy="44" rx="10" ry="7" fill="var(--text-main)"/><ellipse cx="32" cy="42" rx="3" ry="2.2" fill="var(--bg-base)"/><path d="M29,46 Q32,50 35,46" stroke="var(--bg-base)" stroke-width="1.2" fill="none" stroke-linecap="round"/></svg>Sniffox</div>
            <div class="nav-links">
                <a href="#/capture" class="nav-link nav-active" data-route="capture">
                    <span class="nav-icon">&#9654;</span> Capture
                </a>
                <a href="#/graph" class="nav-link" data-route="graph">
                    <span class="nav-icon">&#9672;</span> 3D Graph
                </a>
                <a href="#/security" class="nav-link" data-route="security">
                    <span class="nav-icon">&#9888;</span> Security
                    <span id="alert-badge" class="alert-badge" style="display:none">0</span>
                </a>
                <a href="#/analysis" class="nav-link" data-route="analysis">
                    <span class="nav-icon">&#9881;</span> Analysis
                </a>
                <a href="#/timeline" class="nav-link" data-route="timeline">
                    <span class="nav-icon">&#9866;</span> Timeline
                </a>
                <a href="#/topology" class="nav-link" data-route="topology">
                    <span class="nav-icon">&#9737;</span> Topology
                </a>
                <a href="#/endpoints" class="nav-link" data-route="endpoints">
                    <span class="nav-icon">&#9783;</span> Endpoints
                </a>
                <a href="#/threatintel" class="nav-link" data-route="threatintel">
                    <span class="nav-icon">&#9760;</span> Threat Intel
                </a>
            </div>
            <div class="nav-right">
                <button id="btn-theme" title="Cycle theme: Dark / Dim / Light">
                    <span id="theme-icon">&#9790;</span>
                    <span id="theme-label" class="theme-label">Dark</span>
                </button>
            </div>
        </nav>

        <!-- ==================== CAPTURE PAGE ==================== -->
        <div class="page page-active" data-page="capture">
            <div id="toolbar">
                <div class="toolbar-group">
                    <select id="interface-select">
                        <option value="">-- Select Interface --</option>
                    </select>
                    <input id="bpf-filter" type="text" placeholder="Capture filter (BPF)">
                    <button id="btn-start">&#9654; Start</button>
                    <button id="btn-stop" disabled>&#9632; Stop</button>
                    <div class="live-indicator" id="live-indicator">
                        <span class="live-dot"></span>LIVE
                    </div>
                </div>
                <div class="toolbar-sep"></div>
                <div class="toolbar-group">
                    <select id="filter-preset">
                        <option value="">Presets</option>
                        <optgroup label="Direction">
                            <option value="inbound">Inbound</option>
                            <option value="outbound">Outbound</option>
                            <option value="local">Local Only</option>
                            <option value="external">External</option>
                            <option value="broadcast">Broadcast/Multicast</option>
                            <option value="unicast">Unicast</option>
                        </optgroup>
                        <optgroup label="Protocol">
                            <option value="tcp">TCP</option>
                            <option value="udp">UDP</option>
                            <option value="dns">DNS</option>
                            <option value="http">HTTP</option>
                            <option value="arp">ARP</option>
                            <option value="icmp">ICMP</option>
                            <option value="ipv6">IPv6</option>
                            <option value="tls">TLS</option>
                            <option value="dhcp">DHCP</option>
                            <option value="ntp">NTP</option>
                            <option value="icmpv6">ICMPv6</option>
                            <option value="igmp">IGMP</option>
                            <option value="gre">GRE</option>
                            <option value="sctp">SCTP</option>
                            <option value="stp">STP</option>
                            <option value="ssh">SSH</option>
                            <option value="quic">QUIC</option>
                            <option value="mqtt">MQTT</option>
                            <option value="sip">SIP</option>
                            <option value="modbus">Modbus</option>
                            <option value="rdp">RDP</option>
                        </optgroup>
                        <optgroup label="Combined">
                            <option value="tcp && !dns">TCP (no DNS)</option>
                            <option value="!arp">No ARP</option>
                            <option value="outbound && tcp">Outbound TCP</option>
                            <option value="inbound && !arp">Inbound (no ARP)</option>
                            <option value="external && dns">External DNS</option>
                            <option value="tls && outbound">Outbound TLS</option>
                        </optgroup>
                        <optgroup label="Port">
                            <option value="port=80">Port 80</option>
                            <option value="port=443">Port 443</option>
                            <option value="port=53">Port 53 (DNS)</option>
                            <option value="port=22">Port 22 (SSH)</option>
                        </optgroup>
                    </select>
                    <input id="display-filter" type="text" placeholder="Display filter (e.g. tcp, ip.src==10.0.0.1, flow==1)">
                </div>
                <div class="toolbar-sep"></div>
                <div class="toolbar-group">
                    <button id="upload-btn">
                        Open PCAP
                        <input type="file" id="pcap-file" accept=".pcap,.pcapng,.cap">
                    </button>
                    <button id="btn-clear">Clear</button>
                </div>
            </div>

            <div id="capture-area">
                <!-- Welcome state: shown when no packets -->
                <div class="welcome-state" id="welcome-state">
                    <svg class="welcome-icon" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="32" cy="32" r="28" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                        <circle cx="32" cy="32" r="18" stroke="currentColor" stroke-width="1.5" opacity="0.2"/>
                        <circle cx="32" cy="32" r="8" stroke="currentColor" stroke-width="2" opacity="0.5"/>
                        <circle cx="32" cy="32" r="3" fill="currentColor" opacity="0.8"/>
                        <line x1="32" y1="4" x2="32" y2="14" stroke="currentColor" stroke-width="1.5" opacity="0.3"/>
                        <line x1="32" y1="50" x2="32" y2="60" stroke="currentColor" stroke-width="1.5" opacity="0.3"/>
                        <line x1="4" y1="32" x2="14" y2="32" stroke="currentColor" stroke-width="1.5" opacity="0.3"/>
                        <line x1="50" y1="32" x2="60" y2="32" stroke="currentColor" stroke-width="1.5" opacity="0.3"/>
                    </svg>
                    <div class="welcome-title">Ready to capture</div>
                    <div class="welcome-subtitle">Select a network interface and click Start to begin capturing packets, or open a PCAP file to analyze.</div>
                    <div class="welcome-steps">
                        <div class="welcome-step">
                            <div class="welcome-step-num">1</div>
                            <div class="welcome-step-text">Select an interface</div>
                        </div>
                        <div class="welcome-step">
                            <div class="welcome-step-num">2</div>
                            <div class="welcome-step-text">Click Start to capture</div>
                        </div>
                        <div class="welcome-step">
                            <div class="welcome-step-num">3</div>
                            <div class="welcome-step-text">Analyze packets live</div>
                        </div>
                    </div>
                    <div class="welcome-shortcuts">
                        <div class="welcome-shortcut"><kbd class="kbd">Ctrl</kbd>+<kbd class="kbd">F</kbd> Focus filter</div>
                        <div class="welcome-shortcut"><kbd class="kbd">&uarr;</kbd><kbd class="kbd">&darr;</kbd> Navigate packets</div>
                        <div class="welcome-shortcut"><kbd class="kbd">Esc</kbd> Dismiss overlays</div>
                    </div>
                </div>

                <div class="capture-view-tabs" id="capture-tabs" style="display:none">
                    <button class="capture-view-tab active" data-view="packets">Packets <span class="tab-count" id="tab-pkt-count">0</span></button>
                    <button class="capture-view-tab" data-view="flows">Flows <span class="tab-count" id="tab-flow-count">0</span></button>
                </div>

                <div id="panes" style="display:none">
                    <div id="packet-list-pane" class="pane">
                        <table id="packet-table">
                            <thead>
                                <tr>
                                    <th>No.</th>
                                    <th>Time</th>
                                    <th>Source</th>
                                    <th>Destination</th>
                                    <th>Protocol</th>
                                    <th>Length</th>
                                    <th>Info</th>
                                </tr>
                            </thead>
                            <tbody id="packet-tbody"></tbody>
                        </table>
                    </div>
                    <div class="resizer" id="resizer-1"></div>
                    <div id="packet-detail-pane" class="pane">
                        <div class="detail-tree" id="detail-tree">
                            <div class="empty-state"><span class="empty-state-icon">&#128269;</span>Select a packet to view details</div>
                        </div>
                    </div>
                    <div class="resizer" id="resizer-2"></div>
                    <div id="hex-view-pane" class="pane">
                        <div id="hex-content">
                            <div class="empty-state"><span class="empty-state-icon">&#128290;</span>Select a packet to view hex dump</div>
                        </div>
                    </div>
                </div>

                <!-- Flow Table (hidden by default) -->
                <div id="flow-table-wrap" style="display:none">
                    <div class="flow-table-container">
                        <table id="flow-table" class="flow-table">
                            <thead>
                                <tr>
                                    <th class="flow-th" data-sort="id">Flow</th>
                                    <th class="flow-th" data-sort="srcIp">Source</th>
                                    <th class="flow-th" data-sort="dstIp">Destination</th>
                                    <th class="flow-th" data-sort="protocol">Protocol</th>
                                    <th class="flow-th" data-sort="packetCount">Packets</th>
                                    <th class="flow-th" data-sort="byteCount">Bytes</th>
                                    <th class="flow-th" data-sort="lastSeen">Duration</th>
                                    <th class="flow-th" data-sort="tcpState">State</th>
                                    <th class="flow-th">Fwd/Rev</th>
                                </tr>
                            </thead>
                            <tbody id="flow-table-body">
                                <tr><td colspan="9" class="flow-empty">No flows detected -- start a capture to see connections</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== NETWORK GRAPH PAGE ==================== -->
        <div class="page" data-page="graph">
            <div id="graph-toolbar">
                <span class="page-title">Network Graph</span>
                <div class="graph-capture-controls">
                    <select id="graph-interface-select" class="graph-iface-select">
                        <option value="">-- Interface --</option>
                    </select>
                    <button id="graph-btn-start" class="toolbar-btn graph-capture-btn start">&#9654; Start</button>
                    <button id="graph-btn-stop" class="toolbar-btn graph-capture-btn stop" disabled>&#9632; Stop</button>
                </div>
                <div class="graph-toolbar-right">
                    <button id="btn-3d-controls" class="toolbar-btn" title="Toggle controls panel">Controls</button>
                    <button id="btn-3d-reset" class="toolbar-btn" title="Reset camera">Reset</button>
                    <button id="btn-3d-toggle" class="toolbar-btn" title="Pause/resume">Pause</button>
                    <button id="btn-3d-expand" class="toolbar-btn" title="Expand fullscreen">Expand</button>
                </div>
            </div>
            <div id="graph-body">
                <div id="view3d-pane">
                    <canvas id="view3d-canvas"></canvas>
                    <div id="view3d-legend">
                        <span class="legend-item"><span class="legend-dot" style="background:var(--accent)"></span>TCP</span>
                        <span class="legend-item"><span class="legend-dot" style="background:var(--accent-dim)"></span>UDP</span>
                        <span class="legend-item"><span class="legend-dot" style="background:var(--teal)"></span>DNS</span>
                        <span class="legend-item"><span class="legend-dot" style="background:var(--green)"></span>HTTP</span>
                        <span class="legend-item"><span class="legend-dot" style="background:var(--peach)"></span>ARP</span>
                        <span class="legend-item"><span class="legend-dot" style="background:var(--yellow)"></span>ICMP</span>
                        <span class="legend-item"><span class="legend-dot" style="background:var(--pink)"></span>TLS</span>
                        <span class="legend-item"><span class="legend-dot" style="background:#a6e3a1"></span>IGMP</span>
                        <span class="legend-item"><span class="legend-dot" style="background:#cba6f7"></span>SSH</span>
                        <span class="legend-item"><span class="legend-dot" style="background:#f38ba8"></span>QUIC</span>
                    </div>
                </div>
                <div id="v3d-controls-panel" class="v3d-controls-hidden">
                    <div class="v3d-ctrl-section">
                        <div class="v3d-ctrl-title">Protocol Filters</div>
                        <label class="v3d-proto-label"><input type="checkbox" class="v3d-proto-cb" data-proto="tcp" checked> TCP</label>
                        <label class="v3d-proto-label"><input type="checkbox" class="v3d-proto-cb" data-proto="udp" checked> UDP</label>
                        <label class="v3d-proto-label"><input type="checkbox" class="v3d-proto-cb" data-proto="dns" checked> DNS</label>
                        <label class="v3d-proto-label"><input type="checkbox" class="v3d-proto-cb" data-proto="http" checked> HTTP</label>
                        <label class="v3d-proto-label"><input type="checkbox" class="v3d-proto-cb" data-proto="arp" checked> ARP</label>
                        <label class="v3d-proto-label"><input type="checkbox" class="v3d-proto-cb" data-proto="icmp" checked> ICMP</label>
                        <label class="v3d-proto-label"><input type="checkbox" class="v3d-proto-cb" data-proto="tls" checked> TLS</label>
                        <label class="v3d-proto-label"><input type="checkbox" class="v3d-proto-cb" data-proto="ipv6" checked> IPv6</label>
                        <label class="v3d-proto-label"><input type="checkbox" class="v3d-proto-cb" data-proto="ssh" checked> SSH</label>
                        <label class="v3d-proto-label"><input type="checkbox" class="v3d-proto-cb" data-proto="quic" checked> QUIC</label>
                        <label class="v3d-proto-label"><input type="checkbox" class="v3d-proto-cb" data-proto="igmp" checked> IGMP</label>
                        <label class="v3d-proto-label"><input type="checkbox" class="v3d-proto-cb" data-proto="gre" checked> GRE</label>
                        <label class="v3d-proto-label"><input type="checkbox" class="v3d-proto-cb" data-proto="other" checked> Other</label>
                    </div>
                    <div class="v3d-ctrl-section">
                        <div class="v3d-ctrl-title">Visual Settings</div>
                        <label class="v3d-slider-label">Speed <span id="v3d-speed-val">1.00</span>
                            <input type="range" id="v3d-speed" class="v3d-slider">
                        </label>
                        <label class="v3d-slider-label">Node Size <span id="v3d-nodesize-val">1.00</span>
                            <input type="range" id="v3d-nodesize" class="v3d-slider">
                        </label>
                        <label class="v3d-slider-label">Edge Opacity <span id="v3d-edgeopacity-val">0.25</span>
                            <input type="range" id="v3d-edgeopacity" class="v3d-slider">
                        </label>
                        <label class="v3d-slider-label">Arc Height <span id="v3d-archeight-val">15.00</span>
                            <input type="range" id="v3d-archeight" class="v3d-slider">
                        </label>
                    </div>
                    <div class="v3d-ctrl-section">
                        <div class="v3d-ctrl-title">Find IP</div>
                        <input type="text" id="v3d-ip-search" placeholder="Search IP..." class="v3d-ip-input">
                    </div>
                    <div class="v3d-ctrl-section">
                        <div class="v3d-ctrl-title">Stats</div>
                        <div id="v3d-stats-content"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== SECURITY PAGE ==================== -->
        <div class="page" data-page="security">
            <div id="security-toolbar">
                <span class="page-title">Security Dashboard</span>
                <span id="security-alert-count" class="security-count"></span>
                <div class="security-toolbar-right">
                    <button id="btn-alerts-clear" class="toolbar-btn" title="Clear all alerts">Clear All</button>
                </div>
            </div>
            <div id="security-body">
                <!-- DDoS Attack Banner (hidden by default) -->
                <div id="ddos-banner" class="ddos-banner" style="display:none">
                    <div class="ddos-banner-header">
                        <span class="ddos-banner-icon">&#9888;</span>
                        <span class="ddos-banner-title">DDoS Attack Detected</span>
                        <span id="ddos-type" class="ddos-type-tag"></span>
                    </div>
                    <div class="ddos-banner-details">
                        <div class="ddos-detail"><span class="ddos-label">Source</span><span id="ddos-source" class="ddos-value">—</span></div>
                        <div class="ddos-detail"><span class="ddos-label">Target</span><span id="ddos-target" class="ddos-value">—</span></div>
                        <div class="ddos-detail"><span class="ddos-label">Rate</span><span id="ddos-rate" class="ddos-value">—</span></div>
                        <div class="ddos-detail"><span class="ddos-label">Duration</span><span id="ddos-duration" class="ddos-value">—</span></div>
                    </div>
                    <div id="ddos-chart" class="ddos-chart"></div>
                </div>

                <!-- Dashboard Card Grid -->
                <div class="sec-dashboard">
                    <!-- Threat Level -->
                    <div class="sec-card">
                        <div class="sec-card-title">Threat Level</div>
                        <div id="sec-threat" class="sec-threat-gauge threat-safe">
                            <span class="threat-level-text">SAFE</span>
                        </div>
                        <div id="sec-threat-detail" class="sec-card-sub">No active threats</div>
                    </div>
                    <!-- Traffic Rate -->
                    <div class="sec-card">
                        <div class="sec-card-title">Traffic Rate</div>
                        <div class="sec-card-metrics">
                            <div class="sec-metric"><span id="sec-pps" class="sec-metric-val">0</span><span class="sec-metric-unit">pkt/s</span></div>
                            <div class="sec-metric"><span id="sec-bps" class="sec-metric-val">0</span><span class="sec-metric-unit">B/s</span></div>
                        </div>
                        <div id="sec-rate-sparkline" class="sec-sparkline"></div>
                    </div>
                    <!-- Protocol Distribution -->
                    <div class="sec-card">
                        <div class="sec-card-title">Protocol Distribution</div>
                        <div id="sec-proto-bars" class="sec-proto-bars"></div>
                    </div>
                    <!-- Top Talkers -->
                    <div class="sec-card">
                        <div class="sec-card-title">Top Talkers</div>
                        <div id="sec-top-talkers" class="sec-top-talkers"></div>
                    </div>
                    <!-- Active Attacks -->
                    <div class="sec-card">
                        <div class="sec-card-title">Active Attacks</div>
                        <div class="sec-card-metrics">
                            <div class="sec-metric"><span id="sec-attack-count" class="sec-metric-val">0</span><span class="sec-metric-unit">active</span></div>
                        </div>
                        <div id="sec-attack-tags" class="sec-attack-tags"></div>
                    </div>
                    <!-- Bandwidth -->
                    <div class="sec-card">
                        <div class="sec-card-title">Bandwidth</div>
                        <div class="sec-card-metrics">
                            <div class="sec-metric"><span class="sec-metric-label">In</span><span id="sec-bw-in" class="sec-metric-val">0 B/s</span></div>
                            <div class="sec-metric"><span class="sec-metric-label">Out</span><span id="sec-bw-out" class="sec-metric-val">0 B/s</span></div>
                        </div>
                        <div class="sec-card-metrics sec-bw-totals">
                            <div class="sec-metric"><span class="sec-metric-label">Total In</span><span id="sec-bw-total-in" class="sec-metric-val-sm">0 B</span></div>
                            <div class="sec-metric"><span class="sec-metric-label">Total Out</span><span id="sec-bw-total-out" class="sec-metric-val-sm">0 B</span></div>
                        </div>
                        <div id="sec-bw-sparkline" class="sec-sparkline"></div>
                    </div>
                </div>

                <!-- Dstat-like Protocol Traffic Graph -->
                <div class="sec-dstat-section">
                    <div class="sec-dstat-header">Protocol Traffic Rate (dstat)</div>
                    <div id="sec-dstat-graph" class="sec-dstat-graph">
                        <div class="sec-card-empty">Collecting data...</div>
                    </div>
                </div>

                <!-- Alert List -->
                <div class="sec-alerts-section">
                    <div class="sec-alerts-header">Alert Log</div>
                    <div id="alert-list">
                        <div class="empty-state">No alerts detected</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== ANALYSIS PAGE ==================== -->
        <div class="page" data-page="analysis">
            <div id="analysis-toolbar">
                <span class="page-title">Packet Analysis</span>
                <span id="analysis-pkt-num" class="analysis-pkt-num"></span>
                <span id="analysis-pkt-proto" class="modal-proto"></span>
                <span id="analysis-pkt-info" class="analysis-pkt-info"></span>
                <div class="analysis-toolbar-right">
                    <button id="analysis-export-copy" class="toolbar-btn" title="Copy JSON">Copy JSON</button>
                    <button id="analysis-export-json" class="toolbar-btn" title="Download JSON">Export JSON</button>
                    <button id="analysis-export-hex" class="toolbar-btn" title="Download Hex">Export Hex</button>
                </div>
            </div>
            <div id="analysis-tabs">
                <button class="analysis-tab-btn analysis-tab-active" data-tab="summary">Summary</button>
                <button class="analysis-tab-btn" data-tab="layers">Layers</button>
                <button class="analysis-tab-btn" data-tab="hex">Hex Dump</button>
                <button class="analysis-tab-btn" data-tab="visual">Visualization</button>
                <button class="analysis-tab-btn" data-tab="payload">Payload</button>
            </div>
            <div id="analysis-body">
                <div class="analysis-empty-state" id="analysis-empty">
                    <div class="analysis-empty-icon">&#128270;</div>
                    <div class="analysis-empty-text">Select a packet from the Capture page and click "Deep Analysis" to inspect it here</div>
                </div>
                <!-- Summary Tab -->
                <div class="analysis-tab-panel analysis-tab-panel-visible" data-panel="summary">
                    <div class="modal-section">
                        <div class="modal-section-title">Summary</div>
                        <div id="modal-summary" class="modal-summary-grid"></div>
                    </div>
                    <div class="modal-section">
                        <div class="modal-section-title">Protocol Flow</div>
                        <div id="modal-flow" class="modal-flow-wrap"></div>
                    </div>
                    <div class="modal-columns">
                        <div class="modal-col">
                            <div class="modal-section">
                                <div class="modal-section-title">Protocol Layers</div>
                                <div id="modal-layers"></div>
                            </div>
                        </div>
                        <div class="modal-col">
                            <div class="modal-section">
                                <div class="modal-section-title">TCP Flags</div>
                                <div id="modal-flags"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Layers Tab -->
                <div class="analysis-tab-panel" data-panel="layers">
                    <div class="modal-section">
                        <div class="modal-section-title">Full Protocol Layer Detail</div>
                        <div id="modal-layers-full"></div>
                    </div>
                </div>

                <!-- Hex Tab -->
                <div class="analysis-tab-panel" data-panel="hex">
                    <div class="modal-section">
                        <div class="modal-section-title">Hex Dump</div>
                        <pre id="modal-hex" class="modal-hex-pre"></pre>
                    </div>
                </div>

                <!-- Visualization Tab -->
                <div class="analysis-tab-panel" data-panel="visual">
                    <div class="modal-section">
                        <div class="modal-section-title">Byte Distribution</div>
                        <div id="modal-bytechart"></div>
                    </div>
                    <div class="modal-section">
                        <div class="modal-section-title">Byte Heatmap</div>
                        <div id="modal-heatmap"></div>
                    </div>
                </div>

                <!-- Payload Tab -->
                <div class="analysis-tab-panel" data-panel="payload">
                    <div class="modal-section">
                        <div class="modal-section-title">ASCII Payload</div>
                        <pre id="modal-ascii" class="modal-ascii-pre"></pre>
                    </div>
                    <div class="modal-section">
                        <div class="modal-section-title">Payload Decode</div>
                        <div id="modal-payload-decode"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== TIMELINE PAGE ==================== -->
        <div class="page" data-page="timeline">
            <div class="page-toolbar">
                <span class="page-title">Event Timeline</span>
                <span class="page-subtitle">Interactive timeline of network events with filterable protocol views</span>
            </div>
            <div class="timeline-body">
                <div id="timeline-filters" class="timeline-filters"></div>
                <div class="timeline-canvas-wrap">
                    <canvas id="timeline-canvas"></canvas>
                </div>
            </div>
        </div>

        <!-- ==================== TOPOLOGY PAGE ==================== -->
        <div class="page" data-page="topology">
            <div class="page-toolbar">
                <span class="page-title">Network Topology</span>
                <span class="page-subtitle">Force-directed host-to-host communication graph</span>
            </div>
            <div class="topology-body">
                <canvas id="topology-canvas"></canvas>
            </div>
        </div>

        <!-- ==================== ENDPOINTS PAGE ==================== -->
        <div class="page" data-page="endpoints">
            <div class="page-toolbar">
                <span class="page-title">Endpoints</span>
                <div id="endpoints-stats" class="endpoints-stats"></div>
                <div class="endpoints-toolbar-right">
                    <input type="text" id="endpoints-search" class="endpoints-search" placeholder="Search IP...">
                </div>
            </div>
            <div class="endpoints-body">
                <div class="endpoints-table-container">
                    <table class="endpoints-table" id="endpoints-table">
                        <thead>
                            <tr>
                                <th class="ep-th" data-sort="ip">IP Address</th>
                                <th class="ep-th" data-sort="totalPackets">Packets</th>
                                <th class="ep-th" data-sort="sentPackets">Sent</th>
                                <th class="ep-th" data-sort="recvPackets">Recv</th>
                                <th class="ep-th" data-sort="totalBytes">Bytes</th>
                                <th class="ep-th" data-sort="peers">Peers</th>
                                <th class="ep-th">Protocols</th>
                                <th class="ep-th" data-sort="lastSeen">Last Seen</th>
                            </tr>
                        </thead>
                        <tbody id="endpoints-table-body">
                            <tr><td colspan="8" class="ep-empty">No endpoints observed -- start a capture</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ==================== THREAT INTEL PAGE ==================== -->
        <div class="page" data-page="threatintel">
            <div class="page-toolbar">
                <span class="page-title">Threat Intelligence</span>
                <span class="page-subtitle">MITRE ATT&amp;CK mapping, IOC analysis, and host risk scoring</span>
            </div>
            <div class="ti-body">
                <div class="ti-section">
                    <div class="ti-section-title">MITRE ATT&amp;CK Techniques</div>
                    <div id="ti-mitre-grid" class="ti-mitre-grid"></div>
                </div>
                <div class="ti-grid-2col">
                    <div class="ti-section">
                        <div class="ti-section-title">Risk Score by Host</div>
                        <div id="ti-risk-table" class="ti-risk-table"></div>
                    </div>
                    <div class="ti-section">
                        <div class="ti-section-title">Geo-IP Summary</div>
                        <div id="ti-geo-summary" class="ti-geo-summary"></div>
                    </div>
                </div>
                <div class="ti-section">
                    <div class="ti-section-title">Indicators of Compromise</div>
                    <div id="ti-ioc-list" class="ti-ioc-list"></div>
                </div>
            </div>
        </div>

        <div id="status-bar">
            <div class="status-left">
                <span><span id="connection-indicator" class="disconnected"></span><span id="connection-status">Disconnected</span></span>
                <span>Packets: <span id="packet-count" class="status-value">0</span></span>
                <span>Displayed: <span id="displayed-count" class="status-value">0</span></span>
                <span>Alerts: <span id="alert-total" class="status-value">0</span></span>
                <span id="status-rate" class="status-rate"></span>
            </div>
            <div class="status-right">
                <span id="capture-info"></span>
            </div>
        </div>
    </div>

    <div id="toast-container"></div>

    <!-- 3D View expanded overlay -->
    <div id="v3d-expand-overlay">
        <div class="v3d-expand-header">
            <span class="v3d-expand-title">Network Graph — Expanded View</span>
            <button id="v3d-expand-close" class="v3d-expand-close-btn">&times;</button>
        </div>
        <div class="v3d-expand-body">
            <div id="v3d-expand-canvas-wrap"></div>
        </div>
    </div>

    <!-- Stream Viewer Overlay -->
    <div id="stream-overlay" class="stream-overlay">
        <div class="stream-panel">
            <div class="stream-header">
                <span class="stream-title">Follow TCP Stream</span>
                <div class="stream-view-btns">
                    <button class="stream-view-btn active" data-mode="ascii">ASCII</button>
                    <button class="stream-dl-btn" id="stream-dl-hex" title="Download as hex dump">Save Hex</button>
                    <button class="stream-dl-btn" id="stream-dl-raw" title="Download raw bytes">Save Raw</button>
                </div>
                <button id="stream-close-btn" class="stream-close-btn">&times;</button>
            </div>
            <div id="stream-content" class="stream-content">
                <div class="stream-empty">Select a TCP packet and click "Follow Stream" to view reassembled data</div>
            </div>
        </div>
    </div>

    <script src="js/router.js"></script>
    <script src="js/filters.js"></script>
    <script src="js/hexview.js"></script>
    <script src="js/packetdetail.js"></script>
    <script src="js/packetlist.js"></script>
    <script src="js/flows.js"></script>
    <script src="js/streams.js"></script>
    <script src="js/view3d.js"></script>
    <script src="js/security.js"></script>
    <script src="js/packetmodal.js"></script>
    <script src="js/timeline.js"></script>
    <script src="js/topology.js"></script>
    <script src="js/endpoints.js"></script>
    <script src="js/threatintel.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
